CREATE TYPE "conversation_type" AS ENUM(
'single',
'group'
);

CREATE TABLE "users" (
"id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"firstname" varchar NOT NULL,
"lastname" varchar NOT NULL,
"email" varchar UNIQUE NOT NULL,
"phone" varchar UNIQUE NOT NULL,
"profile_image" varchar,
"password" varchar NOT NULL,
"country" varchar,
"created_at" timestamp default (now()),
"updated_at" timestamp default (now())
);

CREATE TABLE "messages" (
"id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"message" varchar NOT NULL,
"sender_id" int NOT NULL,
"conversation_id" int NOT NULL,
"created_at" timestamp default (now()),
"updated_at" timestamp default (now())
);


CREATE TABLE "conversations" (
"id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"title" varchar NOT NULL,
"image_url" varchar,
"type" conversation_type DEFAULT 'single',
"created_by" int NOT NULL,
"created_at" timestamp default (now()),
"updated_at" timestamp default (now())
);

CREATE TABLE "participants" (
"Ld" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"user_id" int NOT NULL,
"conversation_id" int NOT NULL
);

ALTER TABLE "participants" ADD FOREIGN KEY ("user_id") REFERENCES "users"("id");

ALTER TABLE "participants" ADD FOREIGN KEY ("conversation_id") REFERENCES "conversations"("id");

ALTER TABLE "messages"ADD FOREIGN KEY ("sender_id") REFERENCES "users"("id");

ALTER TABLE "messages"ADD FOREIGN KEY ("conversation_id") REFERENCES "conversations"("id");

ALTER TABLE "conversations"ADD FOREIGN KEY ("created_by")REFERENCES "users"("id");